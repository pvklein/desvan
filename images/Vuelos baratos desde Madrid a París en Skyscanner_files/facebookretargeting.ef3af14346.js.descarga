(function(){Skyscanner.namespace("Skyscanner.tags").FacebookRetargeting=function(){function a(){}var b;return b="561358470665569",a.prototype.createRedirectDataForFlightsSkippy=function(a){var b;return b=a.TransportSearch,{event_name:"Flights_Re-direct",eventdata:{event_name:"Flights_Re-direct",arriving_into:b.Inbound.CityName,num_of_adults:b.Passengers.Adults,num_of_children:b.Passengers.Children,num_of_infants:b.Passengers.Infants,currency:a.currency,outbound_date:b.Dates.Outbound.split("-").join(""),return_date:b.Dates.Inbound.split("-").join(""),departing_from_code:b.Outbound.Airport,departing_from:b.Outbound.CityName,arriving_into_code:b.Inbound.Airport,class_of_travel:b.CabinClass}}},a.prototype.createRedirectDataForCarHireSkippy=function(a){return{event_name:"CarHire_Re-direct",eventdata:{event_name:"CarHire_Re-direct",currency:a.currency}}},a.prototype.getOutboundCode=function(a){var b;return(b=a.TransportSearch.Outbound.Airport)?b:a.TransportSearch.Outbound.City},a.prototype.getInboundCode=function(a){var b;return(b=a.TransportSearch.Inbound.Airport)?b:a.TransportSearch.Inbound.City},a.prototype.createPurchaseDataForFlightsSkippy=function(a){var b,c;return c=this.getOutboundCode(a),b=this.getInboundCode(a),{event_name:"Purchase",eventdata:{content_ids:[a.market+"_"+c+"_"+b],content_type:"product, flight",currency:a.currency,value:a.Redirect?a.Redirect.value:1,origin:a.TransportSearch.Outbound.CityName,destination:a.TransportSearch.Inbound.CityName,origin_airport:a.TransportSearch.Outbound.Airport,destination_airport:a.TransportSearch.Inbound.Airport,departing_departure_date:a.TransportSearch.Dates.Outbound.replace(/-/g,""),returning_departure_date:a.TransportSearch.Dates.Inbound.replace(/-/g,"")}}},a.prototype.createViewContentDataForFlightsSkippy=function(a){var b,c;return c=this.getOutboundCode(a),b=this.getInboundCode(a),{event_name:"ViewContent",eventdata:{content_ids:[a.market+"_"+c+"_"+b],content_type:"product"}}},a.prototype.createRedirectDataToSend=function(a){var b;return b=a.category,"transport"===b?this.createRedirectDataForFlightsSkippy(a):"carhire"===b?this.createRedirectDataForCarHireSkippy(a):{}},a.prototype.createViewContentDataToSend=function(a){return"transport"===a.category?this.createViewContentDataForFlightsSkippy(a):{}},a.prototype.createPurchaseDataToSend=function(a){return"transport"===a.category?this.createPurchaseDataForFlightsSkippy(a):{}},a.prototype.getOrderId=function(a){var b,c;if(a&&"redir"===a.page&&a.Redirect)return a.Redirect.redirectId;try{if(!(b=JSON.parse(localStorage.getItem("auth-storage"))))return;return b.travellerContext?b.travellerContext.utid:null}catch(a){c=a}return null},a.prototype.sendData=function(a,b,c){return window.fbq?"Purchase"===a.event_name?(a.eventdata=a.eventdata||{},a.eventdata.order_id=c,window.fbq("track",a.event_name,a.eventdata)):window.fbq("trackCustom",a.event_name,a.eventdata):(b.push(["track",a.event_name,a.eventdata]),b)},a.prototype.bootstrap=function(a,b,c){var d,e;return e=this.getOrderId(a),"redir"===a.page&&(d=this.extractAppRedirParameters(c),d.advertising_id&&d.client_version?this.sendAppEvents([this.buildAppEvent(this.createRedirectDataToSend(a),e,d.client_version),this.buildAppEvent(this.createPurchaseDataToSend(a),e,d.client_version,"Purchase")],d.advertising_id):(this.sendData(this.createRedirectDataToSend(a),b,e),this.sendData(this.createPurchaseDataToSend(a),b,e))),"day-view"===a.page&&this.sendData(this.createViewContentDataToSend(a),b,e),b},a.prototype.extractAppRedirParameters=function(a){var b,c,d,e,f,g,h;if(b={},a)for(e=a.slice(1).split("&"),c=0,f=e.length;c<f;c++)g=e[c],d=g.split("="),"advertising_id"!==(h=d[0])&&"client_version"!==h||(b[d[0]]=d[1]);return b},a.prototype.buildAppEvent=function(a,b,c,d){var e,f;return f=a.eventdata||{},e=d||a.event_name,f._eventName=e,delete f.event_name,"Purchase"===e&&(f.fb_order_id=b,f._valueToSum=f.value,delete f.value),f.content_ids&&(f.content_ids=JSON.stringify(f.content_ids)),f._appVersion=c,f.fb_currency=f.currency,delete f.currency,f},a.prototype.sendAppEvents=function(a,b){var c;return c={custom_events:a,advertising_id:b},$.ajax({url:"/service/tracking/appredirect",method:"POST",data:JSON.stringify(c),contentType:"application/json; charset=utf-8",dataType:"json"})},a}(),window.fbq?(new Skyscanner.tags.FacebookRetargeting).bootstrap(window.utag_data,window._fbq,window.document.location.search):!function(a,b,c,d,e,f,g){return!!a.fbq||(e=a.fbq=function(){return e.callMethod?e.callMethod.apply(e,arguments):e.queue.push(arguments)},a._fbq||(a._fbq=e),e.push=e,e.loaded=!0,e.version="2.0",e.queue=[],a.injectScript&&injectScript("//connect.facebook.net/en_US/fbevents.js",function(){return(new Skyscanner.tags.FacebookRetargeting).bootstrap(a.utag_data,a._fbq,b.location.search)}))}(window,document)}).call(this);